<!DOCTYPE html>
<!-- This is an autogenerated file - DO NOT EDIT DIRECTLY -->
<!-- This file was generated on Sat May 08 2021 01:21:46 GMT-0700 (Pacific Daylight Time) via the forge in willcarh.art v2.1.0-->
<!-- Learn more: https://github.com/wcarhart/willcarh.art -->
<!-- THIS IS A DEVELOPMENT BUILD, PROCEED WITH CAUTION! -->
<html lang="en">
	<head>
		<!-- metadata -->
		<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>willcarh.art</title>
<meta name="description" content="A Foray into Homebrew" />
<meta name="twitter:card" value="summary" />
<meta property="og:name" content="willcarh.art" />
<meta property="og:url" content="https://willcarh.art/blog/a-foray-into-homebrew" />
<meta property="og:image" content="../../ico/android-chrome-512x512.png" />
<meta property="og:type" content="website" />
<meta property="og:description" content="A Foray into Homebrew" />
<meta property="og:locale" content="en_US" />
<meta property="og:site_name" content="willcarh.art" />

		<!-- CSS -->
		<link rel="stylesheet" href="../../css/common.css">
		<link rel="stylesheet" href="../../css/logo.css">
		<link rel="stylesheet" href="../../css/darkmode.css">
		<link rel="stylesheet" href="../../css/fancylink.css">
		<link rel="stylesheet" href="../../css/linkicons.css">
		<link rel="stylesheet" href="../../css/list.css">
		<link rel="stylesheet" href="../../css/markdown.css">
		<link rel="stylesheet" href="../../css/credits.css">
		<link rel="stylesheet" href="../../css/blog_specific.css">

		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

		<!-- Bootstrap CDN -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

		<!-- icons -->
		<link rel="apple-touch-icon" sizes="180x180" href="../../ico/apple-touch-icon.png">
	    <link rel="icon" type="image/png" sizes="32x32" href="../../ico/favicon-32x32.png">
	    <link rel="icon" type="image/png" sizes="16x16" href="../../ico/favicon-16x16.png">
	    <link rel="manifest" href="../../ico/site.webmanifest">

	    <!-- FontAwesome -->
	    <script src="https://use.fontawesome.com/releases/v5.5.0/js/all.js"></script>

		<!-- animate.css -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

		<!-- site analytics -->
		<script async defer data-domain="willcarh.art" src="https://plausible.io/js/plausible.js"></script>

		<!-- willcarh.art scripts -->
		<script src="../js/darkmode.js"></script>
		<script src="../js/year.js"></script>
		<script src="../js/epochtime.js"></script>
		<script src="../js/readtime.js"></script>
		<script src="../js/blognav.js"></script>
	</head>
	<body>
		<!-- text content -->
		<div id="content-main">
			<div class="spacer"></div>
			<div id="content-body">
				<div id="word-count" class="hidden-tidbit">1512</div>
<div id="read-time" class="hidden-tidbit">8 min read</div>
<div id="next-blog-link" class="hidden-tidbit">how-to-write-better-bash-spinners</div>
<div id="blog-title-container" class="animate__animated animated_faster animate__fadeInUp animate__delay-1s">
	<h1 id="blog-title">A Foray into Homebrew</h1>
	<h3 id="blog-subtitle">How to manage your own tap</h3>
</div>
<div id="blog-credits" class="animate__animated animated_faster animate__fadeInUp animate__delay-2s">
	<div class="row justify-content-center">
		<div id="blog-author-img-container">
			<img id="blog-author-img" alt="author profile image" src="https://storage.googleapis.com/willcarh-art/img/profile.jpg">
		</div>
		<div id="blog-credits-details">
			<h5 id="blog-author">Will Carhart</h5>
			<p class="blog-metadata epochtime-hover">Published on April 22nd, 2020 at 11:30 AM PDT</p>
			<p class="blog-metadata epochtime-hover"></p>
			<p class="blog-metadata readtime-hover"><span class="color">8 min read</span></p>
		</div>
	</div>
</div>
<div id="blog-cover-container" class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<img id="blog-cover" alt="A Foray into Homebrew cover image" src="https://storage.googleapis.com/willcarh-art/img/blog/a-foray-into-homebrew/cover.jpg">
</div>

<div id="blog-content-container" class="blog-border animate__animated animated_faster animate__fadeIn animate__delay-4s">
    <h4 class="content-subtitle">What even is Homebrew, anyways?</h4><p class="content-text">Perhaps you've stumbled upon a new software tool and seen the instructions <code class="inline-code">brew install &lt;name&gt;</code>. As I'm sure you're aware, <code class="inline-code">brew</code> is the CLI for <a class="fancy-link" href="https://brew.sh" target="_blank">Homebrew</a>, the <i>missing package manager</i> for macOS and Linux. Homebrew started as a standard package manager for macOS, as Apple didn't include one by default. You can think of it as macOS's equivalent to <a class="fancy-link" href="https://linuxize.com/post/how-to-use-apt-command/" target="_blank"><code class="inline-code">apt</code></a> or <a class="fancy-link" href="https://www.redhat.com/sysadmin/how-manage-packages" target="_blank"><code class="inline-code">yum</code></a>. Homebrew has since expanded beyond macOS and now supports Linux as well. It uses a modern approach for installing third-party software to your machine, and makes it easy to distribute your home-grown software tools. Let's take a look at Homebrew's nomenclature, how it works, and explore how we can distribute our own software via Homebrew.</p><br><h4 class="content-subtitle">A brief primer of Homebrew's internals</h4><p class="content-text">The most common use case for Homebrew is the aforementioned <code class="inline-code">brew install &lt;name&gt;</code>. What actually happens when we run this? Let's break this command down.</p><p class="content-text">When we type <code class="inline-code">brew install &lt;name&gt;</code>, Homebrew attempts to install, or "brew," the <b class="bold-text">formula</b> <code class="inline-code">&lt;name&gt;</code>. Formulae in Homebrew are package definitions, or the description of how a piece of software should be installed for the current system. We can define a formula for a software package by creating a Ruby file that describes how we should install the package. Homebrew installs formulae to the <b class="bold-text">cellar</b>, a hardcoded location on the local machine. For most Macs, the cellar is <code class="inline-code">/usr/local/Cellar</code>. Homebrew prefixes formulae with a <b class="bold-text">keg</b>, or an installation prefix, to avoid collisions when different versions of the same package are installed. Finally, Homebrew installs formulae from a <b class="bold-text">tap</b>, or a remote repository. The default tap is <a class="fancy-link" href="https://github.com/Homebrew/homebrew-core" target="_blank">Homebrew core</a>, but Homebrew can install from any tap.</p><p class="content-text">This may sound confusing, but keep in mind that Homebrew's nomenclature is based off of homebrewing beer. You <b class="bold-text">brew</b> your <b class="bold-text">formulae</b> in <b class="bold-text">kegs</b> in your <b class="bold-text">cellar</b> from a <b class="bold-text">tap</b>. Homebrew also does a great job at explaining this in their <a class="fancy-link" href="https://docs.brew.sh/Formula-Cookbook" target="_blank">formula cookbook</a>.</p><p class="content-text">Still confused? Let's look at an example.</p><p class="content-text">Let's say I want to install <a class="fancy-link" href="https://www.gnu.org/software/bash/" target="_blank"><code class="inline-code">bash</code></a> on my Mac. Macs with macOS prior to 10.15 <a class="fancy-link" href="https://news.ycombinator.com/item?id=20102597" target="_blank">shipped with Bash 3.2.57</a>, but macOS 10.15+ changed the default shell to <a class="fancy-link" href="https://www.zsh.org/" target="_blank"><code class="inline-code">zsh</code></a>, so if we want to stick with Bash as the default shell we'll need to manually install it. We can install Bash with Homebrew by using <code class="inline-code">brew install bash</code>.</p><p class="content-text">First, Homebrew determines which taps are available on the current machine. If the user has not specified any additional taps, then it will default to <a class="fancy-link" href="https://github.com/Homebrew/homebrew-core" target="_blank">Homebrew core</a>. Next, Homebrew will look for a formula in the core tap for Bash, called <code class="inline-code">bash.rb</code>. If one exists, then it will attempt to install it. Homebrew then follows the instructions defined in <a class="fancy-link" href="https://github.com/Homebrew/homebrew-core/blob/master/Formula/bash.rb" target="_blank">Bash's formula</a>, and installs Bash 5.x into the cellar, with the keg <code class="inline-code">/usr/local/Cellar/bash/5.x</code>. Finally, Homebrew symlinks Bash to <code class="inline-code">usr/local</code> so it is available on the <code class="inline-code">&#36;PATH</code>. After installation is complete, we can use Bash just by typing <code class="inline-code">bash</code>.</p><br><h4 class="content-subtitle">How is Homebrew useful to me?</h4><p class="content-text">Homebrew is a feature-rich and robust package installer. It has many different features, many of which could have their own articles written about them. I think there are two benefits of Homebrew that I use day-to-day.</p><br><p class="content-text"><b class="bold-text">Installing stuff</b></p><p class="content-text">The biggest benefit of Homebrew is using it to actually install software. Homebrew makes installing third-party software a breeze, even if the software I'd like to install isn't included in the default <a class="fancy-link" href="https://github.com/Homebrew/homebrew-core" target="_blank">Homebrew core</a> tap.</p><br><p class="content-text"><b class="bold-text">Distributing my own software</b></p><p class="content-text">The other benefit of Homebrew, which I think is less utilized by individual developers, is the ability to maintain your own tap. Perhaps you've written a new CLI tool (or even a desktop application) that you'd like to distribute to your users. Homebrew makes it easy to set up your own tap and distribute your software without many extra steps, and is built atop existing technologies like Git. Let's take a look at how to do this ourselves.</p><br><h4 class="content-subtitle">Setting up your own Homebrew tap</h4><p class="content-text">Suppose we've written the tool <code class="inline-code">hi</code>, saved in its own repository on GitHub. For now, let's say that repository was <a class="fancy-link" href="https://github.com/wcarhart/willcarh.art" target="_blank">wcarhart/hi</a>. Here's what the source code for <code class="inline-code">hi</code> looks like.</p><pre class="code-container"><code class="block-code">#!/bin/bash<br>for name in "&#36;@" ; do<br>    echo "Hi, &#36;name"<br>done</code></pre><p class="content-text">We want to make our CLI tool <code class="inline-code">hi</code> installable with Homebrew. To start, we'll need to make sure we go into the repository for <code class="inline-code">hi</code> and tag a commit as the <code class="inline-code">v1.0</code> release. Then, we'll need to set up our own tap, which is simply a remote Git repository that will describe how to install <code class="inline-code">hi</code>. As a result we will have two repositories for <code class="inline-code">hi</code>, one for source code and one as a Homebrew tap.</p><p class="content-text">To set up the tap for <code class="inline-code">hi</code>, let's first make a new repository on GitHub. The name of this repository is important, as it will be the name of the tap we reference in our <code class="inline-code">brew install</code> command. The name of our repository on GitHub must be prefixed with <code class="inline-code">homebrew-</code> to tell Homebrew that the repository is a tap. Once we create a new repository <code class="inline-code">homebrew-&lt;tap&gt;</code>, we can install software from our tap with <code class="inline-code">brew install &lt;GitHub username&gt;/&lt;tap&gt;/&lt;formula&gt;</code>. Let's call our new repository <code class="inline-code">homebrew-tools</code> so we can later install <code class="inline-code">hi</code> with <code class="inline-code">brew install wcarhart/tools/hi</code>.</p><p class="content-text">Next, we'll make a new file in our repository <code class="inline-code">Formula/hi.rb</code>. Again, the naming here is important. The <code class="inline-code">Formula/</code> directory tells Homebrew that all files in this directory are Homebrew formulae. The filename <code class="inline-code">hi.rb</code> lets Homebrew know that this formula is for a tool named <code class="inline-code">hi</code>. Note that there can be many formulae in a single tap, specified by each <code class="inline-code">.rb</code> file in the <code class="inline-code">Formula/</code> directory. Here's what <code class="inline-code">Formula/hi.rb</code> should look like.</p><pre class="code-container"><code class="block-code">require "formula"<br><br>class Hi &lt; Formula<br>    desc "A command line tool for saying hello"<br>    homepage "https://github.com/wcarhart/hi"<br>    url "https://github.com/wcarhart/hi/archive/v1.0.tar.gz"<br>    sha256 "ec1f1fc76e228ec3853c95d7c1e46d68ee2b33335c855db65f80f7c208d880c2"<br><br>    depends_on "bash"<br><br>    def install<br>        bin.install "hi"<br>    end<br>end</code></pre><p class="content-text">Let's break down this formula. You don't really need to understand how Ruby works as formulae definitions are not heavy in Ruby-specific features. First, we define the metadata for <code class="inline-code">hi</code>. There are lots of available <a class="fancy-link" href="https://docs.brew.sh/Formula-Cookbook" target="_blank">different metadata</a> that you can define in a formula, but we'll need to include at least <i>four</i> required fields.</p><table><thead><tr><th class="table-align-center" colspan="1">Metadata</th>
<th class="table-align-left" colspan="1">Description</th></tr></thead><tbody><tr><td class="table-align-center"><code class="inline-code">desc</code></td>
<td class="table-align-left">A simple description of the tool.</td></tr>
<tr><td class="table-align-center"><code class="inline-code">homepage</code></td>
<td class="table-align-left">The homepage for the tool, usually the GitHub repository or similar.</td></tr>
<tr><td class="table-align-center"><code class="inline-code">url</code></td>
<td class="table-align-left">The URL that contains the zipped tarball for the tool. For GitHub, this is usually the repository's URL appended with <code class="inline-code">archive/&lt;version&gt;.tar.gz</code>.</td></tr>
<tr><td class="table-align-center"><code class="inline-code">sha256</code></td>
<td class="table-align-left">The SHA-256 hash of the zipped tarball, which will act as a checksum.</td></tr></tbody></table><br><p class="content-text">Next, we define any dependencies of <code class="inline-code">hi</code>. If your tool does not have any dependencies, then this part can be omitted. Since our tool is written in Bash, we specify Bash as a dependency with <code class="inline-code">depends&#95;on "bash"</code>. Here, <code class="inline-code">"bash"</code> does not refer to the actual tool Bash, but rather the Homebrew formula <code class="inline-code">bash.rb</code>. Since no tap is specified (i.e. not <code class="inline-code">"wcarhart/tools/bash"</code>), it's assumed that <code class="inline-code">bash.rb</code> will be found in the default <a class="fancy-link" href="https://github.com/Homebrew/homebrew-core" target="_blank">Homebrew core</a> tap, which <a class="fancy-link" href="https://github.com/Homebrew/homebrew-core/blob/master/Formula/bash.rb" target="_blank">it is</a>.</p><p class="content-text">Finally, we specify what steps should be taken to install <code class="inline-code">hi</code> with the <code class="inline-code">install</code> method. Since this is a simple shell script, all we need to do is move the <code class="inline-code">hi</code> script to the <code class="inline-code">bin/</code> directory. Note that the actual script is called <code class="inline-code">hi</code> and not <code class="inline-code">hi.sh</code>, so the command to run the tool will be <code class="inline-code">hi</code> and not <code class="inline-code">hi.sh</code>. If your tool's file has an extension like <code class="inline-code">.sh</code> or <code class="inline-code">.py</code>, you'll have to add some logic if you want the tool to be invoked without the extension.</p><p class="content-text">There are many other supported features that we can add to our formula, like licenses, build steps, tests, and more. For now, we'll leave our formula nice and simple, but in practice you'll probably see longer formulae than just what we have here.</p><p class="content-text">Now we should be able to install <code class="inline-code">hi</code> with <code class="inline-code">brew install wcarhart/tools/hi</code>, and subsequently the command <code class="inline-code">hi</code> should be globally available from the terminal. Pretty cool!</p><div class="shoutout">
	<p class="shoutout-title"><b>Note</b></p>
	<p class="shoutout-text">The tool <code class="inline-code">hi</code> does not actually exist, so the command <code class="inline-code">brew install wcarhart/tools/hi</code> will not work in reality. However, if you'd like to install one of my real tools, check out <a class="fancy-link" href="https://github.com/wcarhart/homebrew-tools" target="_blank">my tap homebrew-tools</a>.</p>
</div><br><h4 class="content-subtitle">Adding some automation</h4><p class="content-text">As you may have noticed, some of this process can be quite tedious and manual. Every time we bump <code class="inline-code">hi</code>, say to <code class="inline-code">v1.1</code>, we need to update <code class="inline-code">Formula/hi.rb</code> in order for Homebrew to install the latest version. Since I do this regularly, I've written a tool to automate this process, called <a class="fancy-link" href="../project/chiller.html">chiller</a>. Chiller exposes helpful commands like <code class="inline-code">update</code> that will look at the latest release on GitHub and update the formula accordingly, including the SHA-256 hash. You can <a class="fancy-link" href="https://github.com/wcarhart/chiller" target="_blank">check out its code</a>, <a class="fancy-link" href="https://willcarhart.dev/docs/chiller" target="_blank">read its documentation</a>, and even <a class="fancy-link" href="https://github.com/wcarhart/homebrew-tools/blob/master/Formula/chiller.rb" target="_blank">view its formula</a>.</p><br><h4 class="content-subtitle">Conclusion</h4><p class="content-text">Homebrew makes distributing and installing third-party software a breeze. I use Homebrew to distribute a number of my tools, including <a class="fancy-link" href="../project/koi.html">koi</a>, <a class="fancy-link" href="../project/smoosh.html">smoosh</a>, and more. There are many more features of Homebrew that I didn't discuss here, like <a class="fancy-link" href="https://github.com/Homebrew/homebrew-cask" target="_blank">casks</a> for desktop applications or brewing from <a class="fancy-link" href="https://medium.com/prodopsio/creating-homebrew-taps-for-private-internal-tools-c41363d58ab0" target="_blank">private taps</a>. To learn more, check out <a class="fancy-link" href="https://docs.brew.sh/" target="_blank">Homebrew's documentation</a>. If you'd like to take a look at the tap that I maintain, see <a class="fancy-link" href="https://github.com/wcarhart/homebrew-tools" target="_blank">homebrew-tools</a>. If you'd like a complete copy of the code developed in this post, check out <a class="fancy-link" href="https://github.com/wcarhart/willcarh.art-snippets/tree/master/a-foray-into-homebrew" target="_blank">this repository</a>.</p><br><p class="content-text centered-text">🦉</p>
</div>
<div class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<p id="cover-credit">Artwork by <a class="fancy-link" href="https://stock.adobe.com/contributor/207528138/artmirei" target="_blank">Artmirei</a></p>
</div>
<div id="blog-navigation-container" class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<div class="row">
		<div class="col-md-1"></div>
		<div id="blog-navigation-back" class="col-md-4 blog-navigation-chunk">
			<h3><span class="show-more">⟵</span> Back</h3>
			<p class="navigation-detail-text content-text">Go back to the blog</p>
		</div>
		<div class="col-md-2"></div>
		<div id="blog-navigation-next" class="col-md-4 blog-navigation-chunk">
			<h3>Read More <span class="show-more">⟶</span></h3>
			<p class="navigation-detail-text content-text">How to Write Better Bash Spinners</p>
		</div>
		<div class="col-md-1"></div>
	</div>
</div>
<div class="spacer-small"></div>
			</div>
			<div class="spacer"></div>

			<div id="credits" class="row">
	<a id="footer-github-icon" href="https://github.com/wcarhart" target="_blank"><i class="fab fa-github"></i></a>
	<a id="footer-stackoverflow-icon" href="https://stackoverflow.com/users/6246128/wcarhart" target="_blank"><i class="fab fa-stack-overflow" data-fa-transform="left-2"></i></a>
	<a id="footer-linkedin-icon" href="https://linkedin.com/in/willcarhart" target="_blank"><i class="fab fa-linkedin" data-fa-transform="left-2"></i></a>
	<a id="footer-facebook-icon" href="../blog/why-i-deleted-my-facebook.html"><i class="fab fa-facebook-f" data-fa-transform="left-4"></i></a>
	<div style="text-align:center"><a class="fancy-link" href="../etc.html#license">&copy;&nbsp; Will Carhart <span id="year"></span></a></div>
</div>
			<div class="spacer-small"></div>
		</div>

		<!-- logo -->
		<a id="logo-container" href="../../index.html">
	<img id="logo" alt="willcarh.art logo" src="../../ico/android-chrome-512x512.png">
</a>

		<!-- dark mode toggle -->
		<div id="dark-mode-toggle-container">
	<button id="dark-mode-toggle"></button>
</div>
	</body>
</html>