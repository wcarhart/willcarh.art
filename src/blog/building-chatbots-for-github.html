<!DOCTYPE html>
<!-- This is an autogenerated file - DO NOT EDIT DIRECTLY -->
<!-- This file was generated on Tue Dec 01 2020 02:03:19 GMT-0800 (Pacific Standard Time) via the forge in willcarh.art v2.0.0-->
<!-- Learn more: https://github.com/wcarhart/willcarh.art -->
<!-- THIS IS A DEVELOPMENT BUILD, PROCEED WITH CAUTION! -->
<html lang="en">
	<head>
		<!-- metadata -->
		<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>willcarh.art</title>
<meta name="description" content="Building Chatbots for Github" />
<meta name="twitter:card" value="summary" />
<meta property="og:name" content="willcarh.art" />
<meta property="og:url" content="https://willcarh.art/blog/building-chatbots-for-github" />
<meta property="og:image" content="../../ico/android-chrome-512x512.png" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Building Chatbots for Github" />
<meta property="og:locale" content="en_US" />
<meta property="og:site_name" content="willcarh.art" />

		<!-- CSS -->
		<link rel="stylesheet" href="../../css/common.css">
		<link rel="stylesheet" href="../../css/logo.css">
		<link rel="stylesheet" href="../../css/darkmode.css">
		<link rel="stylesheet" href="../../css/fancylink.css">
		<link rel="stylesheet" href="../../css/linkicons.css">
		<link rel="stylesheet" href="../../css/list.css">
		<link rel="stylesheet" href="../../css/markdown.css">
		<link rel="stylesheet" href="../../css/blog_specific.css">

		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

		<!-- Bootstrap CDN -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

		<!-- icons -->
		<link rel="apple-touch-icon" sizes="180x180" href="../../ico/apple-touch-icon.png">
	    <link rel="icon" type="image/png" sizes="32x32" href="../../ico/favicon-32x32.png">
	    <link rel="icon" type="image/png" sizes="16x16" href="../../ico/favicon-16x16.png">
	    <link rel="manifest" href="../../ico/site.webmanifest">

	    <!-- FontAwesome -->
	    <script src="https://use.fontawesome.com/releases/v5.5.0/js/all.js"></script>

		<!-- animate.css -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

		<!-- willcarh.art scripts -->
		<script src="../js/darkmode.js"></script>
		<script src="../js/year.js"></script>
		<script src="../js/epochtime.js"></script>
		<script src="../js/readtime.js"></script>
	</head>
	<body>
		<!-- text content -->
		<div id="content-main">
			<div class="spacer"></div>
			<div id="content-body">
				<div id="word-count" class="hidden-tidbit">1495</div>
<div id="read-time" class="hidden-tidbit">8 min read</div>
<div id="blog-title-container" class="animate__animated animated_faster animate__fadeInUp animate__delay-1s">
	<h1 id="blog-title">Building Chatbots for GitHub</h1>
	<h3 id="blog-subtitle">I am definitely a human beep boop</h3>
</div>
<div id="blog-credits" class="animate__animated animated_faster animate__fadeInUp animate__delay-2s">
	<div class="row justify-content-center">
		<div id="blog-author-img-container">
			<img id="blog-author-img" alt="author profile image" src="https://storage.googleapis.com/willcarh-art/img/profile.jpg">
		</div>
		<div id="blog-credits-details">
			<h5 id="blog-author">Will Carhart</h5>
			<p class="blog-metadata epochtime-hover">Published on August 18th, 2019 at 11:46 PM PDT</p>
			<p class="blog-metadata epochtime-hover">Updated on November 28th, 2020 at 5:33 PM PST</p>
			<p class="blog-metadata readtime-hover"><span class="color">8 min read</span></p>
		</div>
	</div>
</div>
<div id="blog-cover-container" class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<img id="blog-cover" alt="Building Chatbots for GitHub cover image" src="https://storage.googleapis.com/willcarh-art/img/blog/building-chatbots-for-github/cover.jpg">
</div>
<div id="blog-content-container" class="blog-border animate__animated animated_faster animate__fadeIn animate__delay-4s">
    <div class="shoutout">
	<p class="shoutout-title"><b>News Flash!</b></p>
	<p class="shoutout-text">The content and lessons learned from this blog post are a product of my most recent project, <a class="fancy-link" href="https://www.soliloquy.dev" target="_blank">Soliloquy</a>, which I made to promote what I call software-as-a-hobby. If you haven't checked it out yet, I highly recommend it!</p>
</div><br><h4 class="content-subtitle">Let's get chatty!</h4><p class="content-text"><i>Here's an interesting use case:</i>  Suppose you manage a large open source software project. When a new contributor opens a Pull Request, you'd like some tests to run. Pretty standard, right?</p><p class="content-text">However, perhaps you'd also like to inspect the results of these tests and leave the new contributor a personalized comment with why they passed or failed. How would we automate this? Well, first we'd have to somehow automate the testing process, plug that into our repository via <a class="fancy-link" href="https://www.redhat.com/en/topics/devops/what-is-ci-cd" target="_blank">CI/CD</a>, and then pipe the results of our testing to some automated process that could then comment on the Pull Request.</p><p class="content-text">As it turns out, this is very possible! There are many ways to accomplish it; let's discuss one possibility. For our testing, we'll just need <a class="fancy-link" href="https://www.python.org/" target="_blank">Python</a>. For our CI/CD, we'll use <a class="fancy-link" href="https://travis-ci.org/" target="_blank">Travis CI</a>. Finally, for our automated commenting process, we'll make a simple bot using the <a class="fancy-link" href="https://developer.github.com/v3/" target="_blank">GitHub API</a>. I promise it sounds more complex than it actually is! ðŸ˜Š</p><p class="content-text">Let's dive in!</p><br><h4 class="content-subtitle">Utilizing the GitHub API</h4><p class="content-text">Let's start with the <a class="fancy-link" href="https://developer.github.com/v3/" target="_blank">GitHub API</a>. The GitHub API allows us to automate essentially any functionality of GitHub via HTTP requests. For example, you can make a new remote repository like so (in Bash):</p><pre class="code-container"><code class="block-code">curl -X POST -u $USER https://api.github.com/user/repos -d "{ \<br>    \"name\": \"$REPONAME\", \<br>    \"private\": false, \<br>    \"has_issues\": true, \<br>    \"has_downloads\": true, \<br>    \"has_wiki\": false \<br>}"</code></pre><p class="content-text">Pretty cool, right? Here is a <a class="fancy-link" href="https://github.com/wcarhart/konphig/blob/b36320f7d524fa5c1a1c5f2e5f1e4a8231814d09/.bash_functions/Linux/rcreate.sh" target="_blank">Bash function</a> I wrote to create a GitHub remote on the fly, so you don't have to navigate to <a class="fancy-link" href="https://github.com/" target="_blank">github.com</a> when you make a new local repository.</p><p class="content-text">Now, let's consider how we want to use the GitHub API. Rather than dive into the documentation, let's first consider what we want to do <i>as a human</i>. When a new contributor opens a Pull Request, we'd like to eventually leave a comment on that Pull Request about its content. So, we need to automate, via the GitHub API, the ability to leave comments on Pull Requests.</p><p class="content-text">Let's take a look at the <a class="fancy-link" href="https://developer.github.com/v3/" target="_blank">GitHub API</a> Documentation, as this will tell us how to utilize the API for our needs. Intuitively, you might look for the solution in the <a class="fancy-link" href="https://developer.github.com/v3/pulls/" target="_blank">Pull Request</a> section of the documentation. This is a little bit misleading, because while we are leaving a comment on a Pull Request in reality, the GitHub API classifies Pull Request comments <a class="fancy-link" href="https://stackoverflow.com/questions/16744069/create-comment-on-pull-request/16744314#16744314" target="_blank">as the same as Issue comments</a>.</p><p class="content-text">Knowing this, let's take a look at the <a class="fancy-link" href="https://developer.github.com/v3/issues/" target="_blank">Issue section</a> of the documentation. We can see that we can comment on an open Issue or Pull Request via its index number, like so (in Bash):</p><pre class="code-container"><code class="block-code">curl -X POST -u $USER https://api.github.com/repos/$USER/$REPONAME/issues/$PRNUMBER/comments -d "{ \<br>    \"body\": \"Hello, this is a new comment!\" \<br>}"</code></pre><p class="content-text">Bash is kinda hard to read, what would this look like in Python?</p><div class="shoutout">
	<p class="shoutout-title"><b>Heads Up!</b></p>
	<p class="shoutout-text">From here on out, you'll need to use a personal access token to use the <a class="fancy-link" href="https://github.blog/2013-05-16-personal-api-tokens/" target="_blank">Github API</a>. Use <a class="fancy-link" href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line" target="_blank">this helpful tutorial</a> to generate your own token (all you need is a GitHub account). For our purposes, we'll need to select the <code class="inline-code">repo:status</code>, <code class="inline-code">repo_deployment</code>, and public_repo scopes found under the repo category.<br><br><b class="bold-text">A good rule is to not grant your application more privileges than necessary!</b> Often a safe way of storing secrets, like API keys, is to <a class="fancy-link" href="https://askubuntu.com/questions/58814/how-do-i-add-environment-variables/58826#58826" target="_blank">set them as environment variables</a>.</p>
</div><br><p class="content-text">Here's what the above POST request would look like in Python, via the <a class="fancy-link" href="https://realpython.com/python-requests/" target="_blank"><code class="inline-code">requests</code> library</a>:</p><pre class="code-container"><code class="block-code">import os<br>import requests<br><br>GITHUB_TOKEN = os.environ.get('GITHUB_TOKEN')<br>headers = { 'Authorization': f'token {GITHUB_TOKEN}' }<br>content = '{"body":"Hello, this is a new comment!"}'<br>response = requests.post(<br>    f'https://api.github.com/repos/{user}/{repo}/issues/{pr_number}/comments',<br>    headers=headers,<br>    data=content.encode('utf-8')<br>)</code></pre><p class="content-text">Automation is under way! <i>beep boop</i>  ðŸ¤–</p><br><h4 class="content-subtitle">Integrating with Travis CI</h4><p class="content-text">Now that we can leave automated Pull Request comments, let's move onto the next task: <i>How do we get our Python code from above to run every time there's a new Pull Request?</i> </p><p class="content-text"><a class="fancy-link" href="https://www.redhat.com/en/topics/devops/what-is-ci-cd" target="_blank">Continuous Integration and Deployment</a>, or CI/CD, are tools that allow us to automatically run code and tests, as well as deploy software, on a regular basis, such as when code is committed or a new Pull Request is opened. There are many great CI/CD tools. We will be using <a class="fancy-link" href="https://travis-ci.org/" target="_blank">Travis CI</a> because it's free and "fairly" easy to set up.</p><div class="shoutout">
	<p class="shoutout-title"><b>Heads Up!</b></p>
	<p class="shoutout-text">I'm not going to go into depth on setting up Travis CI, so please refer to this <a class="fancy-link" href="https://docs.travis-ci.com/user/tutorial/#to-get-started-with-travis-ci" target="_blank">helpful tutorial</a> if you haven't done that before.</p>
</div><br><p class="content-text">Suppose, for now, we have a Python script for leaving automated comments on Pull Requests in a script called <code class="inline-code">comment.py</code>. Let's use the following <code class="inline-code">.travis.yml</code> file so our script gets run every time a Pull Request is opened.</p><pre class="code-container"><code class="block-code">language: python<br>python:<br>  - 3.7<br>install:<br>  - pip install -r requirements.txt<br>script:<br>  - if [[ $TRAVIS_EVENT_TYPE == "pull_request" && $TRAVIS_PULL_REQUEST_BRANCH != "master" ]] ; then python comment.py ; fi</code></pre><p class="content-text">Breaking this down, the important part is the <code class="inline-code">script</code> section, which uses a Bash statement to check the Pull Request branch. This statement says that if the current commit is via an opened Pull Request, we should run our automated commenting Python script.</p><br><h4 class="content-subtitle">Using Python to glue everything together</h4><p class="content-text">We're almost there! <i>How do we tie it all together?</i> </p><p class="content-text">Now, you'll have to decide how <i>your</i> tests will actually work, and what you're testing for. For example, you could test for the existence of a specific file, like so:</p><pre class="code-container"><code class="block-code">import os<br>def test_file_existence():<br>    return os.path.isfile('myfile.txt')</code></pre><p class="content-text">You could also use a testing framework, like the builtin <a class="fancy-link" href="https://docs.python.org/3/library/unittest.html" target="_blank">unittest</a> Python module. There are endless possibilities!</p><p class="content-text">For now, I'll leave the content of the tests up to you, and make a generic script instead. Let's write some Python code that will run some tests and leave a GitHub comment based on the tests' results. The script below will rely on some <a class="fancy-link" href="https://docs.travis-ci.com/user/environment-variables/#default-environment-variables" target="_blank">Travis CI environment variables</a>, so that the script can be automated when a Pull Request is opened.</p><pre class="code-container"><code class="block-code">import os<br>import requests<br><br>def test_something():<br>    """Run some automated tests"""<br>    test_passed = True<br>    # content of your test goes here, update 'test_passed' accordingly<br><br>    if test_passed:<br>        return 0, "The test passed!"<br>    else:<br>        return 1, "Uh oh, the test failed!"<br><br>def add_github_comment(result, message):<br>    """<br>    Add a comment to a Pull Request in GitHub<br>        :result: (int) exit code of tests, 0 is pass, 1 is fail<br>        :message: (str) the content of the Pull Request comment<br>    """<br>    travis_pull_request = os.environ.get('TRAVIS_PULL_REQUEST')<br>    user = "YOUR GITHUB USERNAME"<br>    repo = "YOUR GITHUB REPOSITORY NAME"<br><br>    GITHUB_TOKEN = os.environ.get('GITHUB_TOKEN')<br>    headers = { 'Authorization': f'token {GITHUB_TOKEN}' }<br>    content = f'{{"body":"{message}"}}'<br>    response = requests.post(<br>        f'https://api.github.com/repos/{user}/{repo}/issues/{travis_pull_request}/comments',<br>        headers=headers,<br>        data=content.encode('utf-8')<br>    )<br><br>def main():<br>    result, message = test_something()<br>    add_github_comment(result, message)<br><br>if __name__ == '__main__':<br>    main()</code></pre><p class="content-text">There ya go! If you have both <code class="inline-code">.travis.yml</code> and the above code saved as <code class="inline-code">comment.py</code> in your repository, you'll get automated comments on Pull Requests!</p><div class="shoutout">
	<p class="shoutout-title"><b>Heads Up!</b></p>
	<p class="shoutout-text">In order for the above code to work, you'll have to add <code class="inline-code">GITHUB_TOKEN</code> as a secure environment variable to your Travis environment. There are a few ways to do this, as outlined in <a class="fancy-link" href="https://docs.travis-ci.com/user/environment-variables/#defining-variables-in-repository-settings" target="_blank">Travis' documentation</a>.</p>
</div><br><br><h4 class="content-subtitle">Getting extra creative</h4><p class="content-text">The above code a great starting point! What else could we accomplish with this?</p><ul><li>We could build more complex Pull Request comments by using [GitHub's markdown language](https://guides.github.com/features/mastering-markdown/) to leave stylized content.</li><li>We could create a [separate GitHub account](https://help.github.com/en/articles/types-of-github-accounts) for our commenting bot.</li><li>We could [deploy our application](https://docs.travis-ci.com/user/deployment), if our tests pass.</li></ul><br><img class="content-img" alt="Screenshot of GitHub bot commenting on a Pull Request" src="https://storage.googleapis.com/willcarh-art/img/blog/building-chatbots-for-github/friendlycommitter.png"><p class="img-subtitle">Friendly Committer commenting on a PR on GitHub</p><br><h4 class="content-subtitle">Closing Notes</h4><p class="content-text">And there you have it! This blog post barely scratches the surface of what automation is possible via Travis CI and the GitHub API. What's even more exciting is the <a class="fancy-link" href="https://github.blog/2019-08-08-github-actions-now-supports-ci-cd/" target="_blank">introduction of CI/CD in GitHub Actions</a>, which was announced in August 2019. Who knows, maybe this tutorial will be deprecated within the near future due to GitHub Actions!</p><div class="shoutout">
	<p class="shoutout-title"><b>Hey there!</b></p>
	<p class="shoutout-text">If you've made a cool software project using some of the lessons from this blog post, I'd love for you to submit it to <a class="fancy-link" href="https://www.soliloquy.dev/" target="_blank">Soliloquy</a>!</p>
</div><br><p class="content-text centered-text">ðŸ¦‰</p>
</div>
<div class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<p id="cover-credit">Artwork by <a class="fancy-link" href="https://www.artstation.com/d3cap" target="_blank">Jason Scheier</a></p>
</div>
<div class="spacer-small"></div>
			</div>
			<div class="spacer"></div>
			<!-- TODO: add 'next blog' button or something like that -->
		</div>

		<!-- logo -->
		<a id="logo-container" href="../../index.html">
			<img id="logo" alt="willcarh.art logo" src="../../ico/android-chrome-512x512.png">
		</a>

		<!-- dark mode toggle -->
		<div id="dark-mode-toggle-container">
			<button id="dark-mode-toggle"></button>
		</div>
	</body>
</html>