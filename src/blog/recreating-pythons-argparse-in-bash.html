<!DOCTYPE html>
<!-- This is an autogenerated file - DO NOT EDIT DIRECTLY -->
<!-- This file was generated on Sun May 09 2021 23:11:49 GMT-0700 (Pacific Daylight Time) via the forge in willcarh.art v2.1.0-->
<!-- Learn more: https://github.com/wcarhart/willcarh.art -->
<!-- THIS IS A DEVELOPMENT BUILD, PROCEED WITH CAUTION! -->
<html lang="en">
	<head>
		<!-- metadata -->
		<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>willcarh.art</title>
<meta name="description" content="Recreating Pythons Argparse in Bash" />
<meta name="twitter:card" value="summary" />
<meta property="og:name" content="willcarh.art" />
<meta property="og:url" content="https://willcarh.art/blog/recreating-pythons-argparse-in-bash" />
<meta property="og:image" content="../../ico/android-chrome-512x512.png" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Recreating Pythons Argparse in Bash" />
<meta property="og:locale" content="en_US" />
<meta property="og:site_name" content="willcarh.art" />

		<!-- CSS -->
		<link rel="stylesheet" href="../../css/common.css">
		<link rel="stylesheet" href="../../css/logo.css">
		<link rel="stylesheet" href="../../css/darkmode.css">
		<link rel="stylesheet" href="../../css/fancylink.css">
		<link rel="stylesheet" href="../../css/linkicons.css">
		<link rel="stylesheet" href="../../css/list.css">
		<link rel="stylesheet" href="../../css/markdown.css">
		<link rel="stylesheet" href="../../css/credits.css">
		<link rel="stylesheet" href="../../css/blog_specific.css">

		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

		<!-- Bootstrap CDN -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

		<!-- icons -->
		<link rel="apple-touch-icon" sizes="180x180" href="../../ico/apple-touch-icon.png">
	    <link rel="icon" type="image/png" sizes="32x32" href="../../ico/favicon-32x32.png">
	    <link rel="icon" type="image/png" sizes="16x16" href="../../ico/favicon-16x16.png">
	    <link rel="manifest" href="../../ico/site.webmanifest">

	    <!-- FontAwesome -->
	    <script src="https://use.fontawesome.com/releases/v5.5.0/js/all.js"></script>

		<!-- animate.css -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

		<!-- site analytics -->
		<script async defer data-domain="willcarh.art" src="https://plausible.io/js/plausible.js"></script>

		<!-- willcarh.art scripts -->
		<script src="../js/darkmode.js"></script>
		<script src="../js/year.js"></script>
		<script src="../js/epochtime.js"></script>
		<script src="../js/readtime.js"></script>
		<script src="../js/blognav.js"></script>
	</head>
	<body>
		<!-- text content -->
		<div id="content-main">
			<div class="spacer"></div>
			<div id="content-body">
				<div id="word-count" class="hidden-tidbit">1372</div>
<div id="read-time" class="hidden-tidbit">7 min read</div>
<div id="next-blog-link" class="hidden-tidbit">a-foray-into-homebrew</div>
<div id="blog-title-container" class="animate__animated animated_faster animate__fadeInUp animate__delay-1s">
	<h1 id="blog-title">Recreating Python's argparse in Bash</h1>
	<h3 id="blog-subtitle">Leading the way in Bash CLI applications</h3>
</div>
<div id="blog-credits" class="animate__animated animated_faster animate__fadeInUp animate__delay-2s">
	<div class="row justify-content-center">
		<div id="blog-author-img-container">
			<img id="blog-author-img" alt="author profile image" src="https://storage.googleapis.com/willcarh-art/img/profile.jpg">
		</div>
		<div id="blog-credits-details">
			<h5 id="blog-author">Will Carhart</h5>
			<p class="blog-metadata epochtime-hover">Published on May 12th, 2020 at 8:00 PM PDT</p>
			<p class="blog-metadata epochtime-hover"></p>
			<p class="blog-metadata readtime-hover"><span class="color">7 min read</span></p>
		</div>
	</div>
</div>
<div id="blog-cover-container" class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<img id="blog-cover" alt="Recreating Python's argparse in Bash cover image" src="https://storage.googleapis.com/willcarh-art/img/blog/recreating-pythons-argparse-in-bash/cover.jpg">
</div>

<div id="blog-content-container" class="blog-border animate__animated animated_faster animate__fadeIn animate__delay-4s">
    <h4 class="content-subtitle">Parsing arguments in Bash can be annoying</h4><p class="content-text">Picture this. You've just finished an amazing new piece of code. It's tested, it has nice logging messages, and you're proud of it. Now comes time to ship it to your coworkers or users. You give your code to your coworker, and she asks how to run it. Well that's obvious, you reply, you just invoke Python, pass in the name of the entrypoint, specify your command line arguments, denote the output folder, and press Enter. Your coworker looks befuddled. Fine, you conclude, I'll make a script to run the application. You create <code class="inline-code">run.sh</code> and add some command line options like <code class="inline-code">-a</code> for argument and <code class="inline-code">-o</code> for the output folder. Your coworker comes back with more questions. Can you use multiple <code class="inline-code">-a</code> arguments at once? Will they overwrite each other? Does <code class="inline-code">-o</code> check for an output folder before executing? Will you be updating the documentation regularly?</p><p class="content-text">Isn't there a better way to do this? Almost every language ships with some form of argument parsing, or has a helpful library nearby. Bash has <a class="fancy-link" href="https://man7.org/linux/man-pages/man3/getopt.3.html" target="_blank">getopt</a>, Python has <a class="fancy-link" href="https://docs.python.org/3/library/argparse.html" target="_blank">argparse</a>, and Node.js has <a class="fancy-link" href="https://yargs.js.org/" target="_blank">yargs</a>. In Python and Node.js, argument parsing is a pleasant experience. You can build autogenerated help menus, control option settings, create mutually exclusive parsing groups, and more. Is this available natively in Bash with getopt? Nope.</p><br><h4 class="content-subtitle">Created by convenience, honed by necessity</h4><p class="content-text">I often found myself writing Bash scripts to run my code. What would initially start out as a <code class="inline-code">run.sh</code> would evolve into a fully featured entrypoint into an application, and I found myself recreating some form of argument parsing in every script. Sometimes it would involve manually checking for a <code class="inline-code">--help</code> flag and printing out a predefined help message. Other times it would involve searching for a specific <code class="inline-code">-a</code> argument and capturing the next token. After some time I noticed how repetitive this process had become, and how it could be automated in the future.</p><p class="content-text">This led to me to create <a class="fancy-link" href="../project/koi.html">koi</a>, a fully-featured and automated argument parser for Bash.</p><br><h4 class="content-subtitle">Pleasant argument parsing in Bash with koi</h4><p class="content-text"><a class="fancy-link" href="../project/koi.html">Koi</a> acts as a single Bash script that parses command line arguments, and was inspired by Python's <a class="fancy-link" href="https://docs.python.org/3/library/argparse.html" target="_blank">argparse</a>. It automatically sets up subcommand parsing on the command line and requires little effort to incorporate into existing scripts.</p><p class="content-text">Let's say you'd like to write a simple script to say hello to someone. This is easy to document and set up with koi. Let's create a new file called <code class="inline-code">say.sh</code>.</p><pre class="code-container"><code class="block-code">#!/bin/bash<br>source koi<br><br>koiname=say.sh<br>koidescription="A script for saying things"<br><br>function hello {<br>    __addarg "-h" "--help" "help" "optional" "" "Greet a person by name"<br>    __addarg "" "name" "positionalvalue" "required" "" "The name of someone you like"<br>    __addarg "-s" "--salutation" "storevalue" "optional" "Hello" "The greeting to use"<br>    __addarg "-e" "--exclaim" "flag" "optional" "" "If included, greeting will be exclaimed"<br>    __parseargs "&#36;@"<br><br>    local exclaim_text=<br>    if [[ &#36;exclaim -eq 1 ]] ; then<br>        exclaim_text='!'<br>    fi<br><br>    echo "&#36;{salutation}, &#36;{name}&#36;{exclaim_text}"<br>}<br><br>__koirun "&#36;@"</code></pre><p class="content-text">What value does koi add here? Let's take a look.</p><p class="content-text">First, koi sets up the script's name and description. These strings are used in all of the automated help menus. Next, koi exposes the <code class="inline-code">&#95;&#95;addarg</code> function, which allows the script author to register command line arguments with a specific function. Any function created in the script can be used as a subcommand on the command line, so <code class="inline-code">hello</code> would effectively become a subcommand. Koi then registers a few types of arguments: a required <code class="inline-code">positionalvalue</code> for reading in the argument <i>name</i>, an optional <code class="inline-code">storevalue</code> for reading in an optional salutation with the default <i>Hello</i>, and an optional <code class="inline-code">flag</code> for whether or not the greeting should be exclaimed.</p><p class="content-text">Based on the registered arguments, koi automatically sets up <code class="inline-code">./say.sh --help</code>.</p><pre class="code-container"><code class="block-code">./say.sh --help</code></pre><pre class="code-container"><code class="block-code">A script for saying things<br><br>Usage:<br>  say.sh COMMAND [args]<br><br>Available commands:<br>  hello<br>  help<br>  list<br><br>Hints:<br>  say.sh help --verbose    Show complete command documentation<br>  say.sh COMMAND --help    Show individual command documentation</code></pre><p class="content-text">Koi also sets up the help menu for each subcommand, such as <code class="inline-code">./say.sh hello --help</code>.</p><pre class="code-container"><code class="block-code">./say.sh hello -h</code></pre><pre class="code-container"><code class="block-code">say.sh hello [-h] [-s SALUTATION] [-e] NAME <br>Greet a person by name<br>  name                           The name of someone you like <br>  -s, --salutation SALUTATION    The greeting to use (optional) (default: Hello) <br>  -e, --exclaim                  If included, greeting will be exclaimed (optional)</code></pre><p class="content-text">Now we have complex argument parsing without any additional logic!</p><pre class="code-container"><code class="block-code">./say.sh hello 'Guido van Rossum' --exclaim</code></pre><pre class="code-container"><code class="block-code">Hello, Guido van Rossum!</code></pre><p class="content-text">Pretty cool!</p><br><h4 class="content-subtitle">A slew of advanced features</h4><p class="content-text"><b class="bold-text">Automated help menus</b></p><p class="content-text">One of the most powerful features of koi is its ability to autogenerate help menus (documentation). When you register an argument with <code class="inline-code">&#95;&#95;addarg</code>, you are required to include help text about the argument, which koi can then use to generate a help menu (as in the example above).</p><p class="content-text">Further documentation: <a class="fancy-link" href="https://www.willcarhart.dev/docs/koi/#/autogenerated_help_menus" target="_blank">Autogenerated help menus</a></p><p class="content-text"><b class="bold-text">Subcommand parsing</b></p><p class="content-text">Another powerful feature of koi is the ability to parse subcommands.</p><p class="content-text">You can either attach your arguments to your script:</p><pre class="code-container"><code class="block-code">./myscript.sh -a arg -b arg</code></pre><p class="content-text">Or, you can attach your arguments to subcommands:</p><pre class="code-container"><code class="block-code">./myscript.sh subcommand -a arg -b arg</code></pre><p class="content-text">This is powerful because it allows you to have more granular control over reading in arguments for different functionality.</p><p class="content-text">Further documentation: <a class="fancy-link" href="https://www.willcarhart.dev/docs/koi/#/subcommands" target="_blank">Subcommands</a></p><p class="content-text"><b class="bold-text">Parsing mutually exclusive groups</b></p><p class="content-text">Sometimes it is helpful to group a script's arguments together. This can be used to require two arguments to be used together, or to prevent more than one optional argument from being used.</p><p class="content-text">For example, suppose <code class="inline-code">myscript.sh</code> had two available flags, <code class="inline-code">--flagA</code> and <code class="inline-code">--flagB</code>. We can use argument grouping to make rules like:</p><ol start=1><li><span>Either <code class="inline-code">--flagA</code> or <code class="inline-code">--flagB</code> can be present, but not both.</span></li><li><span>If <code class="inline-code">--flagA</code> is present, so must be <code class="inline-code">--flagB</code>, and vice versa.</span></li></ol><p class="content-text">Koi offers this functionality with the <code class="inline-code">&#95;&#95;addgroup</code> function.</p><p class="content-text">Further documentation: <a class="fancy-link" href="https://www.willcarhart.dev/docs/koi/#/argument_groups" target="_blank">Argument Groups</a></p><p class="content-text"><b class="bold-text">Verifying arguments</b></p><p class="content-text">Often we need to run some sort of validation on each command line argument. Koi allows you to specify a <i>verifying function</i> that will be run on each registered argument, and comes default with some helpful functionality like verifying that a file or directory exists. This allows us to reuse verifying logic on multiple arguments and keeps our code minimal and clean.</p><p class="content-text">For example, consider the following function <code class="inline-code">check&#95;for&#95;files</code>, which checks for a number of files using the <code class="inline-code">&#95;&#95;verifyfile</code> verifying function.</p><pre class="code-container"><code class="block-code">function check_for_files {<br>    __addarg "-h" "--help" "help" "optional" "" "Check that a number of different files exist"<br>    __addarg "" "--sourcefile" "storevalue" "" "Check that a source file exists" "__verifyfile"<br>    __addarg "" "--destinationfile" "storevalue" "" "Check that a destination file exists" "__verifyfile"<br>    __addarg "" "--anotherfile" "storevalue" "" "Check that another file exists" "__verifyfile"<br>    __parseargs "&#36;@"<br>    # rest of function...<br>}</code></pre><p class="content-text">Further documentation: <a class="fancy-link" href="https://www.willcarhart.dev/docs/koi/#/verifying_arguments" target="_blank">Verifying arguments</a></p><p class="content-text"><b class="bold-text">Default values</b></p><p class="content-text">Sometimes when our scripts offer optional command line arguments, it's helpful for those arguments to have default values. If a user omits a command line argument that is needed to run the function, we can use koi to include a default for that argument.</p><p class="content-text">Further documentation: <a class="fancy-link" href="https://www.willcarhart.dev/docs/koi/#/registering_arguments?id=defaults" target="_blank">Defaults</a></p><p class="content-text"><b class="bold-text">Dependent arguments</b></p><p class="content-text">Sometimes it is helpful to have an argument's usage be tied to another argument's presence. Koi accomplishes this with <i>dependent arguments</i>.</p><p class="content-text">For example, suppose <code class="inline-code">myscript.sh</code> has two available flags, <code class="inline-code">--flagA</code> and <code class="inline-code">--flagB</code>. We can use dependent arguments to define rules like:</p><ol start=1><li><span>If <code class="inline-code">--flagA</code> is present, <code class="inline-code">--flagB</code> must be present.</span></li><li><span><code class="inline-code">--flagB</code> can be present without <code class="inline-code">--flagA</code>.</span></li></ol><p class="content-text">In this example, we say that <code class="inline-code">--flagA</code> is dependent on <code class="inline-code">--flagB</code>. Thus, we refer to <code class="inline-code">--flagA</code> as the dependent argument and <code class="inline-code">--flagB</code> as the dependency argument.</p><p class="content-text">Further documentation: <a class="fancy-link" href="https://www.willcarhart.dev/docs/koi/#/dependent_arguments" target="_blank">Dependent Arguments</a></p><br><h4 class="content-subtitle">Using koi</h4><p class="content-text">Koi was born out of necessity for a better argument parser in Bash, and is currently used in a variety of companies, projects, and applications. If you'd like to get started using koi, it's easy to install with <a class="fancy-link" href="https://brew.sh/" target="_blank">Homebrew</a> using <code class="inline-code">brew install wcarhart/tools/koi</code>. There are other installation options in koi's <a class="fancy-link" href="https://github.com/wcarhart/koi" target="_blank">GitHub repository</a>. If you'd like to read more about koi, check out its dedicated <a class="fancy-link" href="https://www.willcarhart.dev/docs/koi" target="_blank">documentation subsite</a>. You can also find the example script from this blog post in <a class="fancy-link" href="https://github.com/wcarhart/willcarh.art-snippets/tree/master/recreating-pythons-argparse-in-bash" target="_blank">this repository</a>. I hope you enjoy using it as much as I have.</p><br><p class="content-text centered-text">🦉</p>
</div>
<div class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<p id="cover-credit">Artwork by <a class="fancy-link" href="https://stock.adobe.com/contributor/207043170/painterstock" target="_blank">Painterstock</a></p>
</div>
<div id="blog-navigation-container" class="animate__animated animated_faster animate__fadeIn animate__delay-4s">
	<div class="row">
		<div class="col-md-1"></div>
		<div id="blog-navigation-back" class="col-md-4 blog-navigation-chunk">
			<h3><span class="show-more">⟵</span> Back</h3>
			<p class="navigation-detail-text content-text">Go back to the blog</p>
		</div>
		<div class="col-md-2"></div>
		<div id="blog-navigation-next" class="col-md-4 blog-navigation-chunk">
			<h3>Read More <span class="show-more">⟶</span></h3>
			<p class="navigation-detail-text content-text">A Foray into Homebrew</p>
		</div>
		<div class="col-md-1"></div>
	</div>
</div>
<div class="spacer-small"></div>
			</div>
			<div class="spacer"></div>

			<div id="credits" class="row">
	<a id="footer-github-icon" href="https://github.com/wcarhart" target="_blank"><i class="fab fa-github"></i></a>
	<a id="footer-stackoverflow-icon" href="https://stackoverflow.com/users/6246128/wcarhart" target="_blank"><i class="fab fa-stack-overflow" data-fa-transform="left-2"></i></a>
	<a id="footer-linkedin-icon" href="https://linkedin.com/in/willcarhart" target="_blank"><i class="fab fa-linkedin" data-fa-transform="left-2"></i></a>
	<a id="footer-facebook-icon" href="../blog/why-i-deleted-my-facebook.html"><i class="fab fa-facebook-f" data-fa-transform="left-4"></i></a>
	<div style="text-align:center"><a class="fancy-link" href="../etc.html#license">&copy;&nbsp; Will Carhart <span id="year"></span></a></div>
</div>
			<div class="spacer-small"></div>
		</div>

		<!-- logo -->
		<a id="logo-container" href="../../index.html">
	<img id="logo" alt="willcarh.art logo" src="../../ico/android-chrome-512x512.png">
</a>

		<!-- dark mode toggle -->
		<div id="dark-mode-toggle-container">
	<button id="dark-mode-toggle"></button>
</div>
	</body>
</html>